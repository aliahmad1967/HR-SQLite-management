<!-- =====================================================
     نظام إدارة الموارد البشرية - HR Management System
     AttendanceView.xaml - شاشة الحضور والانصراف
     ===================================================== -->
<UserControl x:Class="HRManagementSystem.Views.AttendanceView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             FlowDirection="RightToLeft">

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- العنوان وأزرار الإجراءات -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Text="الحضور والانصراف"
                       Style="{StaticResource HeaderTextStyle}"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="إضافة سجل جديد"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Command="{Binding AddAttendanceCommand}"
                        Margin="0,0,8,0">
                    <Button.ContentTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Plus" VerticalAlignment="Center"/>
                                <TextBlock Text="إضافة سجل جديد" Margin="8,0,0,0"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>
                
                <Button Content="تحديث"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Command="{Binding RefreshCommand}"
                        ToolTip="تحديث البيانات">
                    <Button.ContentTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Refresh" VerticalAlignment="Center"/>
                                <TextBlock Text="تحديث" Margin="8,0,0,0"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>
            </StackPanel>
        </Grid>

        <!-- شريط الفلترة -->
        <Border Grid.Row="1" Style="{StaticResource CardStyle}" Padding="16" Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- التاريخ -->
                <DatePicker Grid.Column="0"
                            Style="{StaticResource MaterialDesignOutlinedDatePicker}"
                            materialDesign:HintAssist.Hint="التاريخ"
                            SelectedDate="{Binding SelectedDate}"
                            FlowDirection="RightToLeft"
                            Margin="0,0,16,0"/>

                <!-- القسم -->
                <ComboBox Grid.Column="1"
                          Style="{StaticResource ArabicComboBoxStyle}"
                          materialDesign:HintAssist.Hint="القسم"
                          ItemsSource="{Binding Departments}"
                          SelectedItem="{Binding SelectedDepartment}"
                          DisplayMemberPath="Name"
                          Margin="0,0,16,0"/>

                <!-- الموظف -->
                <ComboBox Grid.Column="2"
                          Style="{StaticResource ArabicComboBoxStyle}"
                          materialDesign:HintAssist.Hint="الموظف"
                          ItemsSource="{Binding Employees}"
                          SelectedItem="{Binding SelectedEmployee}"
                          DisplayMemberPath="FullName"
                          Margin="0,0,16,0"/>

                <!-- من تاريخ -->
                <DatePicker Grid.Column="3"
                            Style="{StaticResource MaterialDesignOutlinedDatePicker}"
                            materialDesign:HintAssist.Hint="من تاريخ"
                            SelectedDate="{Binding StartDate}"
                            FlowDirection="RightToLeft"/>
            </Grid>
        </Border>

        <!-- جدول الحضور -->
        <Border Grid.Row="2" Style="{StaticResource CardStyle}" Padding="0">
            <DataGrid Style="{StaticResource ArabicDataGridStyle}"
                      ItemsSource="{Binding AttendanceRecords}">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="الموظف" Binding="{Binding Employee.FullName}" Width="*"/>
                    <DataGridTextColumn Header="التاريخ" Binding="{Binding Date, StringFormat='{}{0:yyyy/MM/dd}'}" Width="120"/>
                    <DataGridTextColumn Header="وقت الحضور" Binding="{Binding CheckInTime, StringFormat='{}{0:HH:mm}'}" Width="100"/>
                    <DataGridTextColumn Header="وقت الانصراف" Binding="{Binding CheckOutTime, StringFormat='{}{0:HH:mm}'}" Width="100"/>
                    <DataGridTextColumn Header="ساعات العمل" Binding="{Binding WorkHours, StringFormat='{}{0:F1}'}" Width="100"/>
                    <DataGridTextColumn Header="العمل الإضافي" Binding="{Binding OvertimeHours, StringFormat='{}{0:F1}'}" Width="100"/>
                    <DataGridTextColumn Header="الحالة" Binding="{Binding Status}" Width="100"/>
                    <DataGridTemplateColumn Header="الإجراءات" Width="150">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                            Command="{Binding DataContext.CheckInCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding EmployeeId}"
                                            ToolTip="تسجيل حضور"
                                            IsEnabled="{Binding CheckInTime, Converter={StaticResource NullToBoolConverter}}">
                                        <materialDesign:PackIcon Kind="Login" Foreground="{StaticResource SuccessBrush}"/>
                                    </Button>
                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                            Command="{Binding DataContext.CheckOutCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding EmployeeId}"
                                            ToolTip="تسجيل انصراف">
                                        <materialDesign:PackIcon Kind="Logout" Foreground="{StaticResource ErrorBrush}"/>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- مؤشر التحميل -->
        <ProgressBar Grid.Row="3"
                     IsIndeterminate="True"
                     Style="{StaticResource MaterialDesignCircularProgressBar}"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center"
                     Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"/>
    </Grid>
</UserControl>

